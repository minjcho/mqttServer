# ==========================================
# Mosquitto MQTT Broker Configuration
# ==========================================

# Listener Configuration
listener 1883
protocol mqtt

# ==========================================
# Authentication
# ==========================================
# Disable anonymous access for security
allow_anonymous false

# Password file (created by entrypoint script)
password_file /mosquitto/config/passwd

# ==========================================
# Connection Limits (DoS Prevention)
# ==========================================
# Maximum concurrent connections
# Recommended: 1000-5000 for production
# Adjust based on expected load and system resources
max_connections 1000

# Maximum keep-alive time (seconds)
# Prevents clients from holding connections indefinitely
max_keepalive 3600

# ==========================================
# Message Limits
# ==========================================
# Maximum QoS 1 and 2 messages currently in-flight per client
max_inflight_messages 20

# Maximum queued messages per client
max_queued_messages 1000

# Maximum message size (10MB)
message_size_limit 10485760

# ==========================================
# Persistence
# ==========================================
persistence true
persistence_location /mosquitto/data/

# Save in-memory database to disk every 30 minutes
autosave_interval 1800

# ==========================================
# Logging
# ==========================================
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information

# Log connection messages
connection_messages true

# ==========================================
# Security Notes
# ==========================================
# - For production, consider enabling TLS:
#   listener 8883
#   cafile /mosquitto/config/ca.crt
#   certfile /mosquitto/config/server.crt
#   keyfile /mosquitto/config/server.key
#
# - Monitor connection metrics and adjust limits as needed
# - Rotate password file periodically
